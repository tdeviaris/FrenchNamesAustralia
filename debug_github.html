<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug GitHub Pages</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
    </style>
</head>
<body>
    <h1>Debug GitHub Pages - Search Engine</h1>
    <div id="tests"></div>

    <script src="js/translations.js"></script>
    <script>
        const testsDiv = document.getElementById('tests');

        function addTestResult(title, success, message) {
            const div = document.createElement('div');
            div.className = `test-result ${success ? 'success' : 'error'}`;
            div.innerHTML = `<strong>${title}</strong><br>${message}`;
            testsDiv.appendChild(div);
        }

        function addWarning(title, message) {
            const div = document.createElement('div');
            div.className = 'test-result warning';
            div.innerHTML = `<strong>${title}</strong><br>${message}`;
            testsDiv.appendChild(div);
        }

        // Test 1: Check if translations.js loaded
        setTimeout(() => {
            try {
                if (typeof translations !== 'undefined') {
                    addTestResult('✅ Translations.js', true, 'Successfully loaded translations object');
                    addWarning('Translations Content', `Found ${Object.keys(translations).length} languages: ${Object.keys(translations).join(', ')}`);

                    // Check for search-related translations
                    const fr = translations.fr || {};
                    const en = translations.en || {};
                    const searchKeys = ['search-placeholder', 'search-clear-title', 'search-button-title'];
                    let foundSearchKeys = [];
                    searchKeys.forEach(key => {
                        if (fr[key] || en[key]) foundSearchKeys.push(key);
                    });

                    if (foundSearchKeys.length > 0) {
                        addTestResult('✅ Search Translations', true, `Found search keys: ${foundSearchKeys.join(', ')}`);
                    } else {
                        addTestResult('❌ Search Translations', false, 'No search-related translation keys found');
                    }
                } else {
                    addTestResult('❌ Translations.js', false, 'translations object is not defined');
                }
            } catch (error) {
                addTestResult('❌ Translations.js Error', false, error.message);
            }
        }, 100);

        // Test 2: Test JSON data loading
        setTimeout(() => {
            fetch('data/baudin.json')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                })
                .then(data => {
                    if (Array.isArray(data) && data.length > 0) {
                        addTestResult('✅ Baudin JSON', true, `Successfully loaded ${data.length} records`);

                        // Check first record structure
                        const first = data[0];
                        const requiredFields = ['name_fr', 'name_en', 'lat', 'lon'];
                        const missingFields = requiredFields.filter(field => !first.hasOwnProperty(field));

                        if (missingFields.length === 0) {
                            addTestResult('✅ JSON Structure', true, 'All required fields present in first record');
                        } else {
                            addTestResult('⚠️ JSON Structure', false, `Missing fields: ${missingFields.join(', ')}`);
                        }

                        // Count records with valid GPS
                        const validGPS = data.filter(item => item.lat !== 0 && item.lon !== 0).length;
                        addWarning('GPS Data', `${validGPS}/${data.length} records have valid GPS coordinates`);

                    } else {
                        addTestResult('❌ Baudin JSON Structure', false, 'Data is not an array or is empty');
                    }
                })
                .catch(error => {
                    addTestResult('❌ Baudin JSON', false, `Failed to load: ${error.message}`);
                });
        }, 200);

        // Test 3: Test search DOM elements
        setTimeout(() => {
            const searchElements = {
                'search-input': document.getElementById('search-input'),
                'search-button': document.getElementById('search-button'),
                'search-clear': document.getElementById('search-clear'),
                'search-results': document.getElementById('search-results')
            };

            let foundElements = [];
            let missingElements = [];

            Object.keys(searchElements).forEach(id => {
                if (searchElements[id]) {
                    foundElements.push(id);
                } else {
                    missingElements.push(id);
                }
            });

            if (foundElements.length === 0) {
                addTestResult('❌ Search DOM Elements', false, 'No search elements found - this is a debug page without map');
            } else {
                addTestResult('⚠️ Search DOM Elements', true, `Found: ${foundElements.join(', ')}`);
                if (missingElements.length > 0) {
                    addWarning('Missing Elements', `Missing: ${missingElements.join(', ')}`);
                }
            }
        }, 300);

        // Test 4: Test main.js loading
        setTimeout(() => {
            fetch('js/main.js')
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                })
                .then(code => {
                    if (code.includes('getCurrentLanguage')) {
                        addTestResult('✅ Main.js', true, 'Successfully loaded main.js with language functions');
                    } else {
                        addTestResult('⚠️ Main.js', true, 'Loaded main.js but language functions not found');
                    }
                })
                .catch(error => {
                    addTestResult('❌ Main.js', false, `Failed to load: ${error.message}`);
                });
        }, 400);

        // Test 5: Environment information
        setTimeout(() => {
            const info = {
                'Location': window.location.href,
                'User Agent': navigator.userAgent.substring(0, 100) + '...',
                'Console Available': typeof console !== 'undefined',
                'Fetch Available': typeof fetch !== 'undefined',
                'Local Storage': typeof localStorage !== 'undefined'
            };

            let infoHtml = '';
            Object.keys(info).forEach(key => {
                infoHtml += `<strong>${key}:</strong> ${info[key]}<br>`;
            });

            addWarning('Environment Info', infoHtml);
        }, 500);
    </script>
</body>
</html>